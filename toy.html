<html>
  <head>
    <title></title>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            defer class='remove'></script>
    <!-- script src='../primer/respec-w3c-common.js' async class='remove'></script -->
    <script class='remove'>
      var respecConfig = {
      github: "https://github.com/shapetrees/test-suite/",
      specStatus:     "CG-DRAFT",
      shortName:      "shex-semantics",
      editors: [
        { name:       "ericP" },
      ],
      wg:           "Solid Community Group",
      wgURI:        "https://www.w3.org/community/solid/",
      };
    </script>
    <style>
      body { max-width: inherit !important; }
      .comment { color: #ff1500 }
    </style>
  </head>
  <body>
    <section id="sotd"></section>
    <section id="abstract"></section>
    <section>
      <h2>Example</h2>
      <img src="toy.svg" alt="ShapeTrees and decorators"/>
      <caption><span style="font-weight: bold">Legend</span><br/>
      <span style="color:black">ðŸ¡–</span>: contains<br/>
      <span style="color:blue">ðŸ¡–</span>: referencess<br/>
      <span style="color:green">ðŸ¡–</span>: narrower<br/>
      </caption>
    </section>
    <section>
      <h2>Algorithm</h2>
      <p>
        The <a>generateUI</a> function which takes an <code>eco:Application</code> and language preferences and returns a tuples necessary to construct a UI for e.g. authentication.
      </p>
      <ul>
        <li>function <dfn>generateUI</dfn> (<dfn>app</dfn>:<code>eco:Application</code>, <dfn>langPrefs</dfn>:[xsd:language])
        <ul>
          <li>return <a>app</a>.<code>hasAccessNeedGroup</code>.map(<dfn>Group</dfn> => {
          <ul>
            <li><dfn>shapeTreeUrls</dfn> is the transitive set of ShapeTrees referenced by <a>Group</a>.</li>
            <li><dfn>shapeTreeDecorators</dfn> is the set of <code>ShapeTreeDecorators</code> mentioned in any <a>shapeTreeUrl</a> document that have a <code>tree:prefLabel</code> with a language tag in <a>langPrefs</a>.</li>
            <li><dfn>rootAccessNeeds</dfn> is the set of <code>eco:AccessNeed</code>s refrenced by <a>Group</a>&apos;s <code>eco:requestsAccess</code>.</li>
            <li><dfn>mirrorAccessNeeds</dfn> is the set of <code>AccessNeed</code>s in <a>Group</a> with a <code>eco:supports</code> property.</li>
            <li><dfn>directAccessNeeds</dfn> is the set of <code>AccessNeed</code>s in <a>Group</a> without a <code>eco:supports</code> property.</li>
            <li>for each <dfn>rootAccessNeed</dfn> in <a>rootAccessNeeds</a>
            <ul>
              <a>setAclsFromAccessNeed</a>(<a>rootAccessNeed</a>.<code>registeredShapeTree</code>, <a>rootAccessNeed</a>, <a>directAccessNeeds</a>, <a>mirrorAccessNeeds</a>, <a>shapeTreeDecorators</a>)
            </ul></li>
          </ul></li>
        </ul>
        </li>
      </ul>

      <p>
        The following variables always have the same bindings throughout the recurssive calles to <a>setAclsFromAccessNeed</a>. They may be elided if <a>setAclsFromAccessNeed</a> is lexically scoped within <a>generateUI</a>.
      </p>
      <ul>
        <li><a>directAccessNeeds</a></li>
        <li><a>mirrorAccessNeeds</a></li>
        <li><a>shapeTreeDecorators</a></li>
      </ul>

      <ul>
        <li>function <dfn>setAclsFromAccessNeed</dfn> (<dfn>shapeTreeUrl</dfn>:URL, <dfn>accessNeed</dfn>:AccessNeed, <a>directAccessNeeds</a>, <a>mirrorAccessNeeds</a>, <a>shapeTreeDecorators</a>)
        <ul>
          <li><dfn>decorator</dfn> is the <code>ShapeTreeDecorator</code> with a <code>tree:hasShapeTree</code> = <a>shapeTreeUrl</a>.</li>
          <li><dfn>shapeTreeNode</dfn> is the ShapeTree at <a>shapeTreeUrl</a>.</li>
          <li><dfn>newEntry</dfn> is a tuple of (<a>shapeTreeUrl</a>, <a>decorator</a>, <a>accessNeed</a>, <a>shapeTreeNode</a>).</li>
          <li><dfn>results</dfn> is a list of such tuples, initially populated with <a>newEntry</a></li>
          <li>for each <dfn>narrower</dfn> in a recursive walk of <a>decorator</a>.<code>narrower</code> <span class="comment">// e.g {repo}, labels and milestones above</span>
          <ul>
            <li><dfn>narrowerAccessNeed</dfn> is the accessNeed in <a>directAccessNeeds</a> with a <a>narrowerAccessNeed</a>.<code>registeredShapeTree</code>=<a>narrower</a>.<code>hasShapeTree</code>, if it exists, OR <a>accessNeed</a>.</li>
            <li><dfn>narrowerNode</dfn> si the ShapeTree at <a>narrower</a>.<code>hasShapeTree</code></li>
            <li>add a new tuple (<a>narrower</a>.<code>hasShapeTree</code>, <a>narrower</a>, <a>narrowerAccessNeed</a>, <a>narrowerNode</a>) </li>
          </ul></li>
          <li>for each <dfn>entry</dfn> in <a>results</a>
          <ul>
            <li>for each <dfn>reference</dfn> in <a>entry</a>.<code>shapeTreeNode</code>.<code>references</code>
            <ul>
              <li><dfn>referenceAccessNeed</dfn> is the accessNeed in <a>directAccessNeeds</a> with a <a>referenceAccessNeed</a>.<code>registeredShapeTree</code>=<a>reference</a>, if it exists, OR <a>accessNeed</a>.</li>
              <li><a>setAclsFromAccessNeed</a>(<a>reference</a>, <a>referenceAccessNeed</a>)</li>
            </ul></li>            
          </ul></li>
        </ul>
        </li>
      </ul>
<!--
      <pre>
        function <dfn>generateUI</dfn> (app:URL, langPrefs:[xsd:language])
        <span>
          app.hasAccessNeedGroup.map(<dfn>Group</dfn> => {
          <span>
            <dfn>shapeTreeUrls</dfn> is the transitive set of ShapeTrees referenced by <a>Group</a>.
            <dfn>shapeTreeDecorators</dfn> is the set of <code>ShapeTreeDecorators</code> mentioned in any <a>shapeTreeUrl</a> document.
            <dfn>rootAccessNeeds</dfn> is the set of accessNeeds refrenced by <a>Group</a>&apos;s <code>eco:requestsAccess</code>.
            <dfn>mirrorAccessNeeds</dfn> is the set of <code>AccessNeed</code>s in <a>Group</a> with a <code>eco:supports</code> property.
            <dfn>directAccessNeeds</dfn> is the set of <code>AccessNeed</code>s in <a>Group</a> without a <code>eco:supports</code> property.
            for each <dfn>directAccessNeed</dfn> in <a>directAccessNeeds</a>
            <span>
              <a>setAclsFromAccessNeed</a>(<a>directAccessNeed</a>.<code>registeredShapeTree</code>, <a>directAccessNeed</a>)
            </span>
          </span>
        </span>

        function <dfn>setAclsFromAccessNeed</dfn> (<dfn>shapeTreeUrl</dfn>:URL, <dfn>accessNeed</dfn>:AccessNeed)
        <span>
          <dfn>decorator</dfn> is the <code>ShapeTreeDecorator</code> with a <code>tree:hasShapeTree</code> = <a>shapeTreeUrl</a>.
          <dfn>shapeTreeNode</dfn> is the ShapeTree at <a>shapeTreeUrl</a>.
          <dfn>newEntry</dfn> is a tuple of (<a>shapeTreeUrl</a>, <a>decorator</a>, <a>accessNeed</a>, <a>shapeTreeNode</a>).
          <dfn>results</dfn> is a list of such tuples, initially populated with <a>newEntry</a>
          for each <dfn>narrower</dfn> in a recursive walk of <a>decorator</a>.<code>narrower</code>
          <span>
            <dfn>narrowerAccessNeed</dfn> is the accessNeed in <a>directAccessNeeds</a> with a <a>narrowerAccessNeed</a>.<code>registeredShapeTree</code>=<a>narrower</a>.<code>hasShapeTree</code>, if it exists, OR <a>accessNeed</a>.
            <dfn>narrowerNode</dfn> si the ShapeTree at <a>narrower</a>.<code>hasShapeTree</code>
            add a new tuple (<a>narrower</a>.<code>hasShapeTree</code>, <a>narrower</a>, <a>narrowerAccessNeed</a>, <a>narrowerNode</a>) 
          </span>
          for each <dfn>entry</dfn> in <a>results</a>
          <span>
            for each <dfn>reference</dfn> in <a>entry</a>.<code>shapeTreeNode</code>.<code>references</code>
            <span>
              <dfn>referenceAccessNeed</dfn> is the accessNeed in <a>directAccessNeeds</a> with a <a>referenceAccessNeed</a>.<code>registeredShapeTree</code>=<a>reference</a>, if it exists, OR <a>accessNeed</a>.
              <a>setAclsFromAccessNeed</a>(<a>reference</a>, <a>referenceAccessNeed</a>)
            </span>            
          </span>
        </span>
      </pre>
-->
    </section>
  </body>
</html>
