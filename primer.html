<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
    <title>Footprints Primer</title>
    <script async class="remove" src="//www.w3.org/Tools/respec/respec-w3c-common">
    </script>
    <script class="remove">
      var respecConfig = {
        shortName:      "footprints-spec",
        specStatus:     "ED",
        // specStatus:     "WG-NOTE",
        noRecTrack: true,
        edDraftURI:  "https://janeirodigital.github.io/footprints/primer",
        editors:  [
          { name: "Eric Prud'hommeaux" , w3cid: "2112" },
          { name: "Justin Bingham" }
        ],
        cg: "Solid",
        wgURI: "https://www.w3.org/community/solid/",
        // wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/53154/status",
        github: {
          repoURL: "https://github.com/w3c/mynote/",
          branch: "master"
        },
      };
    </script>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css"/>
    <link rel="stylesheet" href="local.css"/>
    <style>
.cross::before { content: "(see spec)"; font-size: small; vertical-align: top; background-color: buttonface; }

/* draw tree per https://two-wrongs.com/draw-a-tree-structure-with-only-css */
.clt, .clt ul, .clt li {
     position: relative;
}

.clt ul {
    list-style: none;
    padding-left: 32px;
}
.clt li::before, .clt li::after {
    content: "";
    position: absolute;
    left: -12px;
}
.clt li::before {
    border-top: 1px solid #000;
    top: 9px;
    width: 8px;
    height: 0;
}
.clt li::after {
    border-left: 1px solid #000;
    height: 100%;
    width: 0px;
    top: 2px;
}
.clt ul > li:last-child::after {
    height: 8px;
}
li.choice {
    list-style999: none;
    margin-left999: -2.5em;
    padding-left: .2em;
    border-left: .5em solid #a7a;
}
li.choice > ul > li {
}
.choice .either {
    font-weight: bold;
    color: #747;
}
    </style>
  </head>
  <body>

    <section id="abstract">
      <p>
        Semantic Web Applications interoperate by sharing semantics of terms and constellations of data structures.
        This primer introduces <span class="blueprint-label capitol plural">Footprints</span> and describes how Semantic Web Applications use them to consistently interoperate over constellations of data structures.
      </p>
    </section>

    <section id="sotd">
      <p>
        This is a proposal for the structure and use of <span class="blueprint-label capitol plural">Footprints</span> in Solid.
        It is possible that this or a derivative document will become a Solid specification.
      </p>
    </section>

    <section id="introduction">
      <h2>Introduction</h2>
      <div class="issue">
        <p>
          Expand explanation on exactly WHAT footprints are and WHY
          they are needed.
        </p>
      </div>
      <p>
        Realizing the value proposition of the Semantic Web requires manageable access to interoperable data.  To enable interoperability, applications must be able to reliably locate, read and write like data to a Pod consistently.  Solid access controls exploit the resource
        hierarchy to provide sensible intuition and management of nested resources.
        Establishing access scopes for data requires understanding:
      </p>
      <ul>
        <li>the shapes and information content of the data,</li>
        <li>the structure of the resource hierarchy.</li>
      </ul>
      <p>
        RDF&apos;s foundation in unambiguous identifiers provides an infrastructure that allows for interoperability without specifically encouraging it.
        Application interoperability depends on applications sharing semantics for relationships and data structures.
        Within a single resource, shapes languages (e.g. ShEx and SHACL) provide machine-readable, enforceable data structure definitions.
        For applications which exploit constellations of resources, <span class="blueprint-label capitol plural">Footprints</span> express the layout of those resources and associate them with their respective shapes.
      </p>
      <p>
        A <span class="blueprint-label capitol">Footprint</span> defines a prospective tree of related resources which can be read and written by applications.  The <span class="blueprint-label">footprint</span> associates each of these resources with a shape in a schema.
        This allows one to treat a set of related resources as a whole, for access control, organization, validation and data migration purposes.
        When a new tree is needed for storage, the trees is <span class="stamp-label past">stamped</span>, creating a <span class="imprint-label">imprint</span>.

      </p>
    </section>

    <section id="structure">
      <h2><span class="blueprint-label capitol">Footprint</span> Structure <a class="cross" href="spec#structure"></a></h2>
      <div class="issue">
        <p>
          The specific elements of the footprint structure need to be explained
          better. We fly through them in a cursory manner, almost assuming that
          the reader knows what they are and why each is there.
        </p>
      </div>
      <p>
        A <span class="blueprint-label">footprint</span> is a tree structure of <dfn>steps</dfn> which in turn describes a tree structure of Resources (effectively a hierarchy of directories and files).
        Each file or directory is described by <a>step</a>.
        A step consists of:
      </p>
      <ul>
        <li>an <dfn>id</dfn>: an addressable label for this step.</li>
        <li>a <dfn>type</dfn>: LDP type of the associated resource: <code>BasicContainer</code> OR <code>Resource</code>.</li>
        <li class="choice"><span class="either">either of:</span>
        <ul>
          <li>a <dfn>label</dfn>: label for a resource which will always be created;</li>
          <li>a <dfn>uriTemplate</dfn>: pattern for a resource to be matched against a POSTed Slug: header <a class="excode" href="https://github.com/janeirodigital/footprints/blob/master/util/blueprint.js#L280-L297"></a>, . <span class="issue">could use a Link: header instead</span> <span class="issue">what is the problem we are solving here? not sure the stated problem is still relevant, but a new one likely exists in its place</span></li>
        </ul>
        </li>
        <li>any number of <dfn>uses</dfn>: identifies related <span class="blueprint-label plural">footprints</span>..<span class="issue">We need an example of this.</span></li>
        <li class="choice"><span class="either">either of:</span>
        <ul>
          <li>a <dfn>shape</dfn>: The RDF graph structure of any POSTed or PUT resource must conform to this shape;</li>
          <li>a <dfn>mediaType</dfn>: any NonRDF type must specify a media type or a media tree.</li>
        </ul>
        </li>
        <li>an optional <dfn>contents</dfn>: a list of nested steps.</li>
      </ul>
      <p>
        The outer-most step must have an <a>id</a>, has neither a <a>label</a> nor a <a>uriTemplate</a> and has at least one <a>contents</a> arc.
        The PhotoApp has a simple <span class="blueprint-label capitol">Footprint</span> <a class="excode" href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/photo/PhotoBlueprint.jsonld"></a> <span class="issue">Finding it hard to extract much from this example.</span>:
      </p>
      <div>
        <pre><code class="json">
{ "@id": "#root", "type":"ldp:BasicContainer", "contents":[
  { "@id": "#image",
    "type": "ldp:BinaryResource",
    "uriTemplate": "{entryName}",
    "shape": "Photo#Photo"
  }
] }</code></pre>
      </div>
      <p>
        The PhotoAlbumApp&apos;s <span class="blueprint-label capitol">Footprint</span> <a class="excode" href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/album/PhotoAlbumBlueprint.jsonld"></a> uses uriTemplates to discriminate between different types of Resource.
        The top Container holds both images and references.
        They are distinguised by their name, either "img-..." or "ref-...".
        Any entry which is POSTed to the Container must have a Slug: header which matches one of the <a>uriTemplates</a>.
        That match determines the shape for validation and the metadata that the POD will store about the new-created Container member:
      </p>
      <div>
        <pre><code class="json">
{ "@id": "#root", "type": "ldp:BasicContainer", "contents": [
  { "@id": "#img-ref", "type": "ldp:Resource",
    "uriTemplate": "ref-{entryNo}", "shape": "PhotoAlbum#PhotoReference" },
  { "@id":  "#image", "type": "ldp:BinaryResource",
    "uriTemplate": "img-{entryNo}"}
] }
</code></pre>
      </div>
      <p>
        For an example of a complex <span class="blueprint-label capitol">Footprint</span>, the GitApp has a deeply-nested <span class="blueprint-label capitol">Footprint</span> <a class="excode" href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/gh/ghBlueprint.jsonld"></a>.
      </p>
    </section>

    <section id="creating">
      <h2>Creating New Footprint Instances</h2>
      <div class="issue">
        <p>
          Populate this section with how to instantiate a new footprint instance
        </p>
      </div>
      <div class="issue">
        <p>
         This section is no longer accurate. It talks all about what the POD
         will do, when that is not what we're proposing.
        </p>
      </div>
      <p>
        When an application doesn&apos;t find a desired <span class="blueprint-label">footprint</span> appropriate for its use, it must ask the POD to allocate the ldp:Container defined at the root of the <span class="blueprint-label">footprint</span>.
        This is done with a <b><span class="stamp-label past">stamp</span></b> operation, a POST to the parent Container with a <code>rel="<span class="blueprint-label">footprint</span>"</code> Link header <a class="excode" href="https://github.com/janeirodigital/footprints/blob/master/test/test-harness.js#L63-L69"></a>.
        The MultiCal application may know that it has permissions to create a Container for each Calendar within the POD&apos;s <code>/MySharedData</code> Container.
        It would request the POD to create a <code>Calendar</code> Container associated with the "CommonCalendar" application:
      </p>
      <div class="example">
        <p><a href="https://github.com/janeirodigital/footprints/blob/master/test/cal.test.js#L47-L48">associated test</a></p>
        <pre class="http nohighlight"><code>
POST /MySharedData/
Slug: Calendar
Link: &lt;http://www.w3.org/ns/ldp#Container&gt;; rel="type"
Link: <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/CalendarBlueprint.jsonld">http://.../cal/Calendar<span class="blueprint-label capitol">Footprint</span>#calendar</a>; rel="<span class="blueprint-label">footprint</span>"
        </code></pre>
      </div>
      <p>
        The <span class="blueprint-label">footprint</span> will identify one or more Containers into which the application may store Resources.
        The Calendar application&apos;s <span class="blueprint-label">footprint</span> starts from the <code>#calendar</code> node, which happens to be the JSON root in this JSON-LD expression of the <span class="blueprint-label">footprint</span>:
      </p>
      <div>
        <pre><code class="example footprint js">
{ "@context": { ... },
  "@id": "#calendar",
  "type":"ldp:BasicContainer",
  "shape": "Calendar#Calendar",
  "contents":[
    { "@id": "#appointment",
      "type":"ldp:Resource",
      "uriTemplate":"{appointmentNo}",
      "shape": "Calendar#Appointment" }
] }
        </code></pre></div>

      <section id="stamped-image">
        <h3>Resulting Footprint Instance on a Pod</h3>
        <p>
          When an client application <span class="stamp-label capitol">Stamped</span>s a <span class="blueprint-label">footprint</span> <a class="excode" href="https://github.com/janeirodigital/footprints/blob/master/ldpServer.js#L47-L78"></a>, the POD will <!-- record the association between the create a an <code>instantiation</code> of tha.
          This defines -->
        </p>
        <ul>
          <li>Create a Container for that <span class="imprint-label capitol">Imprint</span> (the name of which might respect the Slug: header).
          <ul>
          <li>Create any sub-Containers which have <code>rdfs:label</code>s in the <span class="blueprint-label capitol">Footprint</span>.
          For instance, the GitHub <span class="blueprint-label capitol">Footprint</span> <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/gh/ghBlueprint.ttl#L6">has the nested Containers "repos" and "users"</a> and they in turn have no <code>foot:Contents</code> with <code>rdfs:label</code>s.
          </li>
          </ul>
          <pre><code class="example footprint js">
  { "@context": ...,
    "@id": "#root",
    "type": "ldp:BasicContainer", "contents": [
      {
        "@id": "#repos",
        "type": "ldp:BasicContainer",
        "name": "repos",
        "contents": [
          ...
        ]
      },
      {
        "@id": "#users",
        "type": "ldp:BasicContainer",
        "name": "users",
        "contents": [
          ...
        ] }
    ] }
          </code></pre>
          </li>
          <li>optionally index the <span class="blueprint-label">footprint</span>. This depends on the ecosystem; <!-- see the <a href="#crh-index-footprint">indexing a <span class="blueprint-label">footprint</span> in CRE</a> for a concrete example -->.</li>
          <!-- <li>optionall register the application. This depends on the ecosystem; see the <a href="#crh-index-footprint">registering an agent in CRE</a> for a concrete example.</li> -->
        </ul>
      </section>

    </section>

    <section id="updating">
      <h2>Updating Footprint Instances <a class="cross" href="spec#post-managed"></a></h2>
      <div class="issue">
        <p>
          Populate this section with how to update an existing footprint instance
        </p>
      </div>
      <div class="issue">
        <p>
          This is describing server-side support that isn't part of the current
          proposal. We can maintain a separate body of work that explains
          server-side support for footprints in solid as an extension to the
          solid specification, and propose that separately.
        </p>
      </div>
      <p>
        When POSTing to any Instance Container, there will be a corresponding step in the <span class="blueprint-label capitol">Footprint</span>.
        If the step includes a shape, the POST must include a Link: rel="root" header to identify the node in the POSTed data that should conform to that shape.
      </p>
      <p>
        When receiving a POST to a managed resource, an application POSTs to a Managed Container, the POD locates the corresponding step in the <span class="blueprint-label capitol">Footprint</span>.
        If the step includes a shape, the POST body is parsed and the root node is tested for conformance.
        If it&apos;s invalid, the requested with a 422 Unprocessable Entity message.
        If it&apos;s valid or has no associated shape, the typical LDP processing will create an entity whose contents include the POSTed body.
      </p>
      <p>If processing produces no errors, the POD will again Create any sub-Containers which have <code>rdfs:label</code>s in the <span class="blueprint-label capitol">Footprint</span>.
      For instance, the <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/gh/ghBlueprint.ttl#L21">GitHub <span class="blueprint-label capitol">Footprint</span> step for {userName}</a> has a nested Containers <code>Subscriptions</code>s (and many others).
      </p>
      <pre><code class="example footprint js">
      { "@id": "#root",
      "type":"ldp:BasicContainer", "contents":[
      ... ,
      { "type": "ldp:BasicContainer", "name":"users",
      "contents": [
        { "type":"ldp:BasicContainer", "uriTemplate":"{userName}",
          "shape": "ghSchema#PersonShape",
          "contents": [
            { "type":"ldp:BasicContainer", "name":"subscriptions",
              "shape": "ghSchema#C_SubscrShape",
              "contents": [
                { "type":"ldp:Resource", "uriTemplate":"{subscriptName}",
                  "shape": "ghSchema#SubscrShape" }
              ]}
          ]}
      ]}
      ]}
      </code></pre>
    </section>

    <section id="examples">
      <h2>Examples</h2>

      <p>
        This document describes the use of <span class="blueprint-label capitol plural">Footprints</span> using three example tasks:
      </p>
      <ul>
        <li><b>PhotoAlbum</b> - collects photos or references to photos into sharable albums (<span class="blueprint-label">footprint</span> <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/album/PhotoAlbumFootprint.ttl">Turtle</a> / <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/album/PhotoAlbumFootprint.jsonld">JSON-LD</a>, <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/album/PhotoAlbum.shex">schema</a>).</li>
        <li><b>MultiCal</b> - migrates calendar applications between two common formats, "Common" (<span class="blueprint-label">footprint</span> <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/CalendarFootprint.ttl">Turtle</a> / <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/CalendarFootprint.jsonld">JSON-LD</a>, <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/Calendar.shex">schema</a>), and "Google" (<span class="blueprint-label">footprint</span> <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/GoogleFootprint.ttl">Turtle</a> / <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/GoogleFootprint.jsonld">JSON-LD</a>, <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/GoogleCalendar.shex">schema</a>).</li>
        <li><b>GitHub</b> - a storage repository associating users or groups with repositories, issues and events (<span class="blueprint-label">footprint</span> <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/gh/ghFootprint.ttl">Turtle</a> / <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/gh/ghFootprint.jsonld">JSON-LD</a>, <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/gh/ghSchema.shex">schema</a>).</li>
      </ul>
      <p>
        The application directories described in this document are suffixed with "App" to make it easy to distinguish the App directory from the possibly similarly-named application and <span class="blueprint-label">footprint</span>.
      </p>
      <p>
        <span class="blueprint-label capitol plural">Footprints</span> can enable compatible applications to interoperate by identifying resources they can share.
        Conventions for indexing <span class="blueprint-label plural">footprints</span> and storing application metadata allow applications to find interoperable data and identify the applications that depend on or manipulate that data.
        The ecosystem consists of a Resource hierarchy and an Agent description:
        <!-- For an example, see the <a href="">Common Resource Ecosystem</a> described later. -->
      </p>
      <section id="environment">
        <h2>Example Environment</h2>
        <p>
          The "Resource Layout" used in the subsequent examples can be thought of like a filesystem layout; it is the hierarchy implied by the path components of Resource URLs.
          <span class="blueprint-label capitol plural">Footprints</span> enhance interoperability of installed applications by following conventions for where to install <span class="blueprint-label plural">footprints</span>.
          This ties the hierarchy defined in a <span class="blueprint-label capitol">Footprint</span> to the hierarchy defined for the ecosystem.
        </p>
      </section>

      <section id="photolibrary">
        <h3>Photo Library - Organizing photos into shareable albums</h3>
        <div class="issue">
          <p>
            Detail and expand this example. Seems like the name should be Photo
            Library if we're explaining the use of more than one album. Consider
            making an overarching library shape that brings them together.
          </p>
        </div>
      </section>

      <section id="multical">
        <h3>Multi Calendar - Integration across multiple calendar formats</h3>
        <div class="issue">
          <p>
            Detail and expand this example.
          </p>
        </div>
        <p>
          Because MultiCal is a gateway between multiple event formats, it registers a second <span class="blueprint-label">footprint</span>:
        </p>
        <div class="example">
          <p><a href="https://github.com/janeirodigital/footprints/blob/master/test/cal.test.js#L56-L57">associated test</a></p>
          <pre class="http nohighlight"><code>
  POST /MySharedData/
  Slug: Google
  Link: &lt;http://www.w3.org/ns/ldp#Container&gt;; rel="type"
  Link: <a href="https://github.com/janeirodigital/footprints/blob/master/solidApps/staticRoot/cal/GoogleBlueprint.jsonld">http://.../cal/Google<span class="blueprint-label capitol">Footprint</span>#top</a>; rel="<span class="blueprint-label">footprint</span>"
          </code></pre>
        </div>
        <p>
          This <span class="blueprint-label">footprint</span> provisions a nested container called <code>Events</code> and specifies that every event in that container conform to the <code>&lt;EventShape&gt;</code>.
        </p>
        <div class="">
          <pre><code class="example footprint js">
  { "@context": { ... },

    "@id": "#top",
    "type": "ldp:BasicContainer" ,
    "contents": [
      { "@id": "#Events",
        "type": "ldp:BasicContainer" ,
        "name": "Events",
        "contents": [
          { "@id": "#Event",
            "type": "ldp:Resource",
            "uriTemplate": "{EventName}",
            "shape": "GoogleCalendar#EventShape" }
      ] }
  ] }
          </code></pre>
        </div>
      </section>
      <section id="gitrepo">
        <h3>GitHub - Deeply nested footprints</h3>
        <div class="issue">
          <p>
            Detail and expand this example. Still feels to me that we could
            come up with an example that doesn't make people think of a SaaS
            service. If the aim is to show deeply nested footprints something more
            generic like a forum with sections, threads, and messages might be
            more appropriate.
          </p>
        </div>
      </section>
    </section>



    <script src="http://www.w3.org/2019/Talks/1209-swat4ls-egp/highlight.pack.js"></script>
    <script src="http://www.w3.org/2019/Talks/1209-swat4ls-egp/highlight-shexc.js"></script>
    <!-- <script src="WWW/2019/Talks/1209-swat4ls-egp/highlight-shexc.js"></script> -->
    <script>
      if (location.search) {debugger
        const [blueprint, imprint, stamp] = location.search.substr(1).split(/,/).map(unescape);
        function cap (elt, str) {
          return elt.classList.contains('capitol')
            ? str.substr(0, 1).toUpperCase() + str.substr(1)
            : str;
        }
        function pl (elt, str) {
          return elt.classList.contains('plural')
            ? str + 's'
            : str;
        }
        function trimVowel (str) {
          return str.match(/[aeiou]$/)
            ? str.substr(0, str.length - 1)
            : str;
        }
        document.title = blueprint.substr(0, 1).toUpperCase() + blueprint.substr(1) + 's Primer';
        document.querySelectorAll('.blueprint-label').forEach(elt => {
          elt.innerText = pl(elt, cap(elt, blueprint));
        })
        document.querySelectorAll('.imprint-label').forEach(elt => {
          elt.innerText = pl(elt, cap(elt, imprint));
        })
        document.querySelectorAll('.stamp-label').forEach(elt => {
          let text = cap(elt, stamp);
          if (elt.classList.contains('gerund'))
            text = trimVowel(text) + 'ing';
          if (elt.classList.contains('past'))
            text = trimVowel(text) + 'ed';
          elt.innerText = text;
        })
      }
      // TODO: add ShEx highlighter to respec
      hljs.registerLanguage('shexc', hljsDefineShExC);
      hljs.registerLanguage('turtle', hljsDefineTExpr);
      (['DOMContentLoaded', 'load']).forEach(e => addEventListener(e, init, false));
      let inited = false;

      function hljsDefineTExpr (highlightjs) { // works pretty well for Turtle.
        const ret = hljsDefineShExC(highlightjs, 'tripleConstraint');
        ret.disableAutodetect = true;
        return ret;
      }

      function init () {
        if (inited) return;
        inited = true;
        ([400, 800, 1600]).forEach(
          tOut => setTimeout(highlightAll, tOut)
        )
      }

      function highlightAll () {
        console.log(new Date())
        try {
          const blocks = document.querySelectorAll('.shexc,.turtle');
          [].forEach.call(blocks, (b) => {
            hljs.highlightBlock(b);
          });
        } catch (e) {}
      }
    </script>
  </body>
</html>
