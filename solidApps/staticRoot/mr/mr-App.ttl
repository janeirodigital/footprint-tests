@prefix solid: <http://www.w3.org/ns/solid/terms#> .
@prefix eco: <http://www.w3.org/ns/solid/ecosystem#> .
@prefix acl: <http://www.w3.org/ns/auth/acl#> .
@prefix tree: <http://www.w3.org/ns/shapetree#> .

<#agent>
    a eco:Application ;
    eco:applicationDescription "Health!" ;
    eco:applicationDevelopedBy "HealthDev.co" ;
    eco:authorizationCallback <https://healthpad.example/callback> ;
    eco:applicationDecoratorIndex <mr-ShapeTree-SKOS> ;
    eco:groupedAccessNeeds <#general>, <#med-management> .

<#general>
    a eco:AccessNeedGroup ;
    eco:requestsAccess <#medical-record-r>, <#dashboard-r> ;
    eco:authenticatesAsAgent <acl:Pilot> .

<#med-management>
    a eco:AccessNeedGroup ;
    eco:requestsAccess <#prescriptions-rw> ;
    eco:authenticatesAsAgent <acl:Pilot> .

# "root" rules (referenced by the AccessNeedsGroup)

<#medical-record-r>
    a eco:AccessNeed ; 
    eco:inNeedSet <#general> ;
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <mr-ShapeTree#medicalRecords> ;
    eco:recursivelyAuthorize true ;
    eco:requestedAccess acl:Read .
    
<#dashboard-r>
    a eco:AccessNeed ;
    eco:supports <#medical-record-r> ;
    eco:inNeedSet <#general> ;    
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <dashboard-ShapeTree#dashboards> ;
    eco:recursivelyAuthorize true ;
    eco:requestedAccess acl:Read .

# overrides

<#patient-rw>
    eco:inNeedSet <#general>, <#med-management> ;
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <mr-ShapeTree#patients> ;
    eco:recursivelyAuthorize true ;
    eco:requestedAccess acl:Read, acl:Write .

<#prescriptions-rw>
    eco:inNeedSet <#med-management> ;
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <mr-ShapeTree#prescriptions> ;
    eco:recursivelyAuthorize false ;
    eco:requestedAccess acl:Read, acl:Write .

<#condition-rw>
    eco:inNeedSet <#general> ;
    eco:requestedAccessLevel eco:Required ;
    tree:hasShapeTree <mr-ShapeTree#conditions> ;
    eco:recursivelyAuthorize true ;
    eco:requestedAccess acl:Read, acl:Write .

